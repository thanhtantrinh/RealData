
@{
    ViewBag.Title = "Index";
}

<script src="~/Scripts/jquery-1.10.2.js"></script>
@*<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>*@
<script src="../../Content/jquery.splitflap.js"></script>
<script src="http://underscorejs.org/underscore-min.js"></script>


 <!--Reference the SignalR library. -->
<script src="Scripts/jquery.signalR-2.2.0.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="signalr/hubs"></script>

<table><tr><td><img src="~/images/departureIcon.png" width="40" height="40" /></td><td>&nbsp;&nbsp;</td><td><h2>Airport - Departures</h2></td></tr></table>


<table id="DepartureBoard">
    <tr>
        <td style="width: 100px;font-size:20px">ID</td>
        <td style="width: 100px;font-size:20px">Time</td>
        <td style="width: 500px;font-size:20px">Destination</td>
        <td style="width: 150px;font-size:20px">Flight no.</td>
        <td style="width: 100px;font-size:20px">Gate</td>
        <td style="width: 250px;font-size:20px">Status</td>
    </tr>
    <tr>
        <td></td>
        <td>
            <div id="destination"></div>
        </td>
    </tr>
</table>


<script>
    
    (function ($) {
        
        var departures;

        var Animate = function (departure, checkOldValues) {
            
            var originalIndex = _.findIndex(departures, function (value) { return value.Id === departure.Id });;

            if (departures[originalIndex].Id !== departure.Id || !checkOldValues) {
                departures[originalIndex].Id = departure.Id;
                AnimateField('#Id' + departure.Id, departure.DisplayId);
            };

            if (departures[originalIndex].Time !== departure.Time || !checkOldValues) {
                departures[originalIndex].Time = departure.Time;
                AnimateField('#Time' + departure.Id, departure.Time);
            };

            if (departures[originalIndex].Destination !== departure.Destination || !checkOldValues) {
                departures[originalIndex].Destination = departure.Destination;
                AnimateField('#Dest' + departure.Id, departure.Destination);
            };

            if (departures[originalIndex].FlightNo !== departure.FlightNo || !checkOldValues) {
                departures[originalIndex].FlightNo = departure.FlightNo;
                AnimateField('#Flight' + departure.Id, departure.FlightNo);
            };

            if (departures[originalIndex].Gate !== departure.Gate || !checkOldValues) {
                departures[originalIndex].Gate = departure.Gate;
                AnimateField('#Gate' + departure.Id, departure.Gate);
            };

            if (departures[originalIndex].Remarks !== departure.Remarks || !checkOldValues) {
                departures[originalIndex].Remarks = departure.Remarks;
                AnimateField('#Remarks' + departure.Id, departure.Remarks);
            };
        };

        var AnimateField = function(domId, value)
        {
            var ratio = 0.4;
                $(domId).splitFlap({
                    text: value,
                    charWidth: 50 * ratio,
                    charHeight: 100 * ratio,
                    imageSize: (2500 * ratio) + 'px ' + (100 * ratio) + 'px'
                }).animate();
        }

        $(document).ready(function () {

            $.getJSON("http://localhost:53480/", function (result) {
                departures = result;
                $.each(result, function (i, field) {
                    $("#DepartureBoard").append("<tr><td><div id='Id" + field.Id + "'></div></td><td><div id='Time" + field.Id + "'></div></td><td><div id='Dest" + field.Id + "'></td><td><div id='Flight" + field.Id + "'></div></td><td><div id='Gate" + field.Id + "'></div></td><td><div id='Remarks" + field.Id + "'></div></td></tr></tr>");

                    Animate(field, false);
                                       
                });               
            });


            var monitorHub = $.connection.flightInfoHub;
            
            monitorHub.client.updateFlightBoardInfo = function (departures) {
                $.each(departures, function (i, departure) {
                    Animate(departure, true)
                });
            };

            $.connection.hub.logging = true;

            $.connection.hub.start();
        });
    })(jQuery);


</script>




